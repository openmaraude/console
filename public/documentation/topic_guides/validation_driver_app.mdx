#### Validation d'une application chauffeur

Avant de fournir les accès à la plateforme de production, l'équipe le.taxi teste votre application afin de vérifier que les fonctionnalités principales sont correctement implémentées. Voici une liste régulièrement mise à jour des tests que nous effectuons.


##### Informations du compte à jour

Les informations de votre compte doivent être à jour : l'email et le téléphone du référent technique sont définis dans la section ["mon compte"](/account).


##### Enregistrement d'un chauffeur

Une fois l'application installée, le chauffeur peut s'inscrire en fournissant :

* les informations de l'ADS : numéro code INSEE de la commune ([POST /ads](https://dev.api.taxi/doc/#/default/post_ads))
* les informations du chauffeur : licence professionnelle et département ([POST /drivers](https://dev.api.taxi/doc/#/default/post_drivers))
* les informations du véhicule : plaque d'immatriculation ([POST /vehicles](https://dev.api.taxi/doc/#/default/post_vehicles))

Un appel à [POST /taxis](https://dev.api.taxi/doc/#/default/post_taxis) est ensuite effectué pour créer l'objet.

Les erreurs renvoyées par l'API sont correctement affichées. Par exemple, si le département n'existe pas, l'API retourne une erreur HTTP/400 qui est affichée sur l'application.


##### Changement et synchronisation du statut

Le chauffeur peut changer son statut afin d'être libre ou occupé dans l'application (ou directement connecté au
taximètre).
Ces changements de statut doivent être envoyés à l'API le.taxi pour synchroniser la visibilité dans les applications
client  ([PUT /taxis/:id](https://dev.api.taxi/doc/#/default/put_taxis__taxi_id_)).

Vos serveurs effectuent régulièrement du polling sur le statut du taxi ([GET
/taxis/:id](https://dev.api.taxi/doc/#/default/get_taxis__taxi_id_)) (~ 2-5 min).
Si vous détectez une incohérence entre le statut de l'application ou taximètre et le statut du registre,
particulièrement si l'API le.taxi change le statut du taxi pour le mettre à *off* (voir *Délai dépassé* ci-dessous),
vous devez le détecter et réagir :
- soit prévenir le chaufeur qu'il n'est plus visible sur le registre suite à une demande de course ignorée, et lui
  demander s'il est disponible ou non pour que le statut de l'application et du registre corresponde à la situation sur le
  terrain (par exemple, il vient de prendre une course en maraude physique mais il a oublié de se mettre occupé sur l'application) ;
- soit renvoyer automatiquement de vos serveurs le statut actuel, sans intervention du chauffeur, tant que ça ne conduit
  pas le chauffeur à ignorer les demandes de courses le.taxi, alors qu'il a obligation d'honorer les courses en maraude.

En résumé, le statut le.taxi est décorrélé du statut de votre application ou taximètre et il vous appartient de
synchroniser ce dernier sur le registre, et de réagir en cas d'incohérence ou de laisser le chauffeur décider.  La règle
de base étant qu'un taxi au lumineux vert doit envoyer sa position au registre et avoir le statut disponible pour être
visible dans les applications client.

##### Envoi de la géolocalisation du véhicule

L'application envoie les informations de géolocalisation du véhicule à vos serveurs. Vous devez régulièrement (< 10
secondes) envoyer à nos serveurs les dernières géolocalisations, à minima lorsque le statut du taxi est *free*
([POST /geotaxi](https://dev.api.taxi/doc/#/default/post_geotaxi_)).

##### Réception d'une course

Lorsqu'un client demande une course au chauffeur, la demande s'affiche sur l'application.

###### Acceptation

Le chauffeur doit pouvoir accepter la demande.

###### Refus

Le chauffeur doit pouvoir refuser la course (cas légitimes).

###### Délai dépassé

Si le chauffeur n'effectue aucune action dans le temps imparti, l'API le.taxi annule la demande et passe le statut du
taxi à *off*. Ceci permet au client de renouveler sa demande à un autre taxi alentour. Vous devez réagir à ce changement
de statut pour ne pas laisser le chauffeur dans cette situation.


##### Acceptation du client

Le chauffeur est notifié lorsque le client confirme sa demande ([GET /hails/:id](https://dev.api.taxi/doc/#/default/get_hails__hail_id_)). Le chauffeur se dirige vers le client.

Le vrai numéro du client est maintenant affiché au lieu du masque « 0600000000 ».

##### Refus du client

La course est mise à jour si le client ne confirme pas sa demande ([GET /hails/:id](https://dev.api.taxi/doc/#/default/get_hails__hail_id_)).

##### Délai dépassé pour le client

La course est mise à jour si le client ne confirme pas sa demande dans le temps imparti ([GET /hails/:id](https://dev.api.taxi/doc/#/default/get_hails__hail_id_)).

###### Déclarer le client à bord

Le chauffeur peut déclarer que le client est à bord ([PUT /hails/:id](https://dev.api.taxi/doc/#/default/put_hails__hail_id_)).

###### Incident

Le chauffeur peut déclarer un incident : il ne peut pas aller chercher le client, et souhaite annuler la course ([PUT /hails/:id](https://dev.api.taxi/doc/#/default/put_hails__hail_id_)).


##### Course en cours

Le client est à bord, le chauffeur se rend vers la destination du client.

###### Terminer la course

Le chauffeur doit pouvoir déclarer la course comme terminée ([PUT /hails/:id](https://dev.api.taxi/doc/#/default/put_hails__hail_id_)).

###### Déclarer un incident

À tout moment, le chauffeur peut déclarer un incident ([PUT /hails/:id](https://dev.api.taxi/doc/#/default/put_hails__hail_id_)).
